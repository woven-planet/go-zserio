{{- $scope := .pkg }}
{{- $field := .field }}
{{- $native := goNativeType $scope $field.Type }}
{{- $name := printf "v.%s" $field.Name }}
{{- if $field.IsOptional}}
    {{- $name = printf "(*v.%s)" $field.Name }}
{{- end }}
{{- if and $native.RequiresCast (not $field.Array) }}
    {{- if $native.IsMarshaler }}
        {{- $name = printf "(*%s)(&v.%s)" (goType $scope $native.Type) $field.Name }}
        {{- if $field.IsOptional}}
            {{- $name = printf "(*%s)(v.%s)" (goType $scope $native.Type) $field.Name }}
        {{- end }}
    {{- else }}
        {{- $name = printf "%s(%s)" (goType $scope $native.Type) $name }}
    {{- end }}
{{- end }}

{{- if $field.OptionalClause }}
    if {{ goExpression $scope $field.OptionalClause }} {
{{- end }}
{{- if not (eq $field.Alignment 0) }}
    endBitPosition += ztype.CountAlignBits(endBitPosition, {{ $field.Alignment }})
{{- end }}
{{if $field.IsOptional}}
    endBitPosition += 1
    if v.{{ $field.Name }} != nil {
    {{- template "builtin_bitsizeof.go.tmpl" dict "pkg" $scope "name" $name "native" $native "isarray" $field.Array }}
    }
{{- else}}
    {{- template "builtin_bitsizeof.go.tmpl" dict "pkg" $scope "name" $name "native" $native "isarray" $field.Array }}
{{- end}}
{{- if $field.OptionalClause }}
    }
{{- end }}